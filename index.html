<!DOCTYPE html>
<html>

<head>
    <title>Web shell</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
    <script src="/js/jquery.terminal.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        $(function() {
            const PROMPT = 'Maude>';
            const MAUDE = 'Maude> ';
            const LOAD = 'load';
            const QUIT = 'quit';
            const COMANDO_NO_VALIDO = 'Comando no valido: ';

            var socket = io.connect('http://localhost:9090');
            var terminal = $('#terminal').terminal(function(command, terminal) {
                var cmd = command.substr(0, LOAD.length);
                console.log(cmd);

                if (cmd == LOAD || cmd == QUIT) {
                    terminal.error(COMANDO_NO_VALIDO + command);
                } else {
                    socket.emit('stdin', command);
                }

            }, {
                greetings: '',
                prompt: PROMPT,
                exit: false
            });
            socket.on('stdout', function(data) {
                var salida = String(data);

                if (salida.endsWith(MAUDE)) {
                    salida = salida.substr(0, salida.length - MAUDE.length);
                }

                terminal.echo(salida);
            });
            socket.on('stderr', function(data) {
                terminal.error(String(data));
            });
            socket.on('disconnect', function() {
                terminal.disable();
            });
            socket.on('enable', function() {
                terminal.enable();
            });
            socket.on('disable', function() {
                terminal.disable();
            });
        });
    </script>
    <link type="text/css" href="/css/jquery.terminal.css" rel="stylesheet" />
</head>

<body>
    <div id="terminal"></div>
    <a href="javascript:void(0)"></a>
    <a id="fork" href="https://github.com/you"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67"
            alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>
</body>

</html>